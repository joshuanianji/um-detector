<!DOCTYPE html>

<html>
<head>
  <title>Voice Recorder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"/>
  <link rel="stylesheet" href="index.css">
  <script src="./dist/recorder.min.js"></script>
  <script src="recorder.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.2.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.8/firebase-storage.js"></script>
  <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
      apiKey: "AIzaSyCvMjCrKbCnF3elFFfU6nRsZcKGnaKiCz0",
      authDomain: "um-detector-jaco.firebaseapp.com",
      projectId: "um-detector-jaco",
      storageBucket: "um-detector-jaco.appspot.com",
      messagingSenderId: "505592409960",
      appId: "1:505592409960:web:9f6af4f48b2113e66670dd",
      measurementId: "G-1JB6Z3E6CB"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>

  <div class="box">
    <h1>Voice Recorder</h1>
    <p>Hit start to start recording, and stop to stop recording.</p>

    <button id="start" class="button is-success is-small" disabled>Start</button>
    <button id="pause" class="button is-secondary is-small" disabled>Pause</button>
    <button id="resume" class="button is-secondary is-small" disabled>Resume</button>
    <button id="stopButton" class="button is-danger is-small" disabled>Stop</button>

    <script>
      if (!Recorder.isRecordingSupported()) {
        console.log("Recording features are not supported in your browser.");
      }

      else {
          start.disabled = false;

          var options = {
            monitorGain:  0,
            recordingGain: 1,
            numberOfChannels: 1,
            encoderSampleRate: 16000,
            wavBitDepth: 16,
            encoderPath: "waveWorker.min.js"
            // sourceNode: sourceNode
          };

          var recorder = new Recorder(options);

          var recorderPause = function(){ recorder.pause(); };
          var recorderStop = function(){ recorder.stop(); };
          var recorderResume = function(){ recorder.resume(); };
          var recorderStart = function(){
            recorder.start().catch(function(e){
              console.log('Error encountered:', e.message );
            });
          };

          pause.addEventListener( "click", recorderPause);
          resume.addEventListener( "click", recorderResume);
          stopButton.addEventListener( "click", recorderStop);
          start.addEventListener( "click", recorderStart);

          recorder.onstart = function(e){
            console.log('Recorder is started');
            start.disabled = resume.disabled = true;
            pause.disabled = stopButton.disabled = false;
          };

          recorder.onstop = function(e){
            console.log('Recorder is stopped');
            start.disabled = false;
            pause.disabled = resume.disabled = stopButton.disabled = true;
          };

          recorder.onpause = function(e){
            console.log('Recorder is paused');
            pause.disabled = start.disabled = true;
            resume.disabled = stopButton.disabled = false;
          };

          recorder.onresume = function(e){
            console.log('Recorder is resuming');
            start.disabled = resume.disabled = true;
            pause.disabled = stopButton.disabled = false;
          };

          recorder.ondataavailable = function( typedArray ){
            console.log('Data received');
            var dataBlob = new Blob( [typedArray], { type: 'audio/wav' } );
            var fileName = new Date().toISOString() + ".wav";

            // add file to Firebase storage
            //var storageRef = firebase.storage().ref();
            //var audioRef = storageRef.child(fileName);
            //audioRef.put(dataBlob).then((snapshot) => {
            //  console.log('Upload successful');
            //});


            //var upload = document.createElement('a');
          	//upload.href="#";
          	//upload.innerHTML = "Upload";
          	//upload.addEventListener("click", function(event){
      		  var xhr=new XMLHttpRequest();
      		  xhr.onload=function(e) {
      		      if(this.readyState === 4) {
      		          console.log("Server returned: ",e.target.responseText);
      		      }
                console.log(this.status);
      		  };
      		  var fd=new FormData();
      		  fd.append("audio_data", dataBlob, fileName);
            //console.log(fd.entries());
      		  //xhr.open("POST","upload.php",true);
            xhr.open("POST", fd, true);
            //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      		  xhr.send(fd);

            check.addEventListener('click', function(){
              var newxhr = new XMLHttpRequest();
              newxhr.onload=function(e) {
                console.log('hello');
                alert('hello');
                //if(this.readyState === 4) {
                    //console.log("Server returned: ",e.target.responseText);
                //}
                //this.open()
              };
              newxhr.open("GET", 'server', true);
              newxhr.send(null);
            });
/*
            var newxhr = new XMLHttpRequest();
            newxhr.onload=function(e) {
              console.log('hello');
              alert('hello');
              //if(this.readyState === 4) {
                  //console.log("Server returned: ",e.target.responseText);
              //}
              //this.open()
            };
            newxhr.open("GET", fileName, true);
            newxhr.send(null);
*/
          	//});
          	//li.appendChild(document.createTextNode (" "));//add a space in between
          	//li.appendChild(upload);//add the upload link to li

          };
      }

    </script>
  </div>

  <div class="box">
    <h1>Enter your video call link here:</h1>
    <input id="url" class="is-success is-rounded" />
    <button id="submitUrl">Submit</button>
    <button id="check">Check</button>
    <script>
      submitUrl.addEventListener('click', function(){
        MyWindow = window.open(url.value.toString(), 'MyWindow', 'width=800, height=600');
      });
    </script>
  </div>

</body>
</html>


<!-- <!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"
    />
    <link rel="stylesheet" href="index.css">

    <script defer src="render.js"></script>
  </head>
  <body>
    <h1>ðŸ’– Hello World!</h1>
    <p>Welcome to your Electron application.</p>

    <video></video>

    <button id="startButton" class="button is-primary">Start Recording</button>
    <button id="stopButton" class="button is-warning">Stop Recording</button>

    <hr />

    <button id="getAudioButton" class="button is-text">
      Choose an Audio Source
    </button>

  </body>
</html> -->
